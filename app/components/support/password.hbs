{{page-title "Password"}}

<div class="card mb-3">
  <div class="card-header sc">
    <label class="fs-4 fw-bold ms-3" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_LOGIN_ACCOUNT'}}">{{t 'PAGE_PASSWORD_LOGIN_ACCOUNT'}}</label>
  </div>
  <div class="card-body">
    <div class="row py-1 ps-3">
      <div class="col">
          <label tabindex="0" aria-label="{{t 'PAGE_PASSWORD_USERNAME'}}">{{t 'PAGE_PASSWORD_USERNAME'}}</label>
      </div>
      <div class="col">
        {{log @user}}
        {{#if (not-eq @user.admin null)}}
          <select class="form-select" {{on "change" this.updateSelectedUser}}>
            <option value={{@user.admin.UserID}}>{{@user.admin.Username}}</option>
            <option value={{@user.enduser.UserID}}>{{@user.enduser.Username}}</option>
          </select>
        {{else}}
          <select class="form-select" {{on "change" this.updateSelectedUser}} disabled>
            <option value={{@user.enduser.UserID}}>{{@user.enduser.Username}}</option>
          </select>
        {{/if}}
      </div>
    </div>
    <div class="row py-1 ps-3">
      <div class="col"></div>
      <div class="col">
        <button 
          type="button" 
          class="button btn btn-light btn-sm" 
          {{on "click" this.showChangePasswordModal}} 
          {{on "keyup" this.eaactrl.btnTrigger}}
          tabindex="0"
          aria-label="{{t 'PAGE_RESTART_RESTART'}}"
          {{!--disabled={{unless this.selectedUser 'disabled'}}--}}>
        {{t 'PAGE_PASSWORD_CHANGE_PASSWORD_BUTTON'}}
        </button>
      </div>
    </div>
  </div>
</div>

<BsModal @open={{this.isModalOpen}} @onHide={{this.closeModal}} @backdropClose={{false}} as |Modal|>
  <Modal.header tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_TITLE'}}">
    {{t 'PAGE_PASSWORD_POPUP_TITLE'}}
  </Modal.header>

  <Modal.body>
    <label for="current-password" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_CURRENT_PASSWORD'}}">{{t 'PAGE_PASSWORD_CURRENT_PASSWORD'}}</label>
    <Inputpwd id="current-password" @value={{this.currentPassword}}
           {{on "input" (fn this.handleInput "currentPassword")}} />

    <label for="new-password" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_NEW_PASSWORD'}}">{{t 'PAGE_PASSWORD_POPUP_NEW_PASSWORD'}}</label>
    <Inputpwd id="new-password" @value={{this.newPassword}} 
           {{on "input" (fn this.handleInput "newPassword")}} 
           {{on "input" this.checkPasswordStrength}} />

    <label for="reenter-password" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_RE-ENTER_NEW_PASSWORD'}}">{{t 'PAGE_PASSWORD_POPUP_RE-ENTER_NEW_PASSWORD'}}</label>
    <Inputpwd id="reenter-password" @value={{this.reenterPassword}} 
           {{on "input" (fn this.handleInput "reenterPassword")}} />

    <div class="password-strength-container">
      {{#if (eq this.strength 0)}}
        <p id="password-strength" class="strength0" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: {{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_VERY_WEAK'}}">
          {{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: <span id="strength-indicator" class="weak">{{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_VERY_WEAK'}}</span>
        </p>
      {{else if (eq this.strength 1)}}
        <p id="password-strength" class="strength0" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: {{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_WEAK'}}">
          {{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: <span id="strength-indicator" class="weak">{{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_WEAK'}}</span>
        </p>
      {{else if (eq this.strength 2)}}
        <p id="password-strength" class="strength1" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: {{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_MEDIUM'}}">
          {{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: <span id="strength-indicator" class="medium">{{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_MEDIUM'}}</span>
        </p>
      {{else if (gt this.strength 2)}}
        <p id="password-strength" class="strength2" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: {{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_STRONG'}}">
          {{t 'PAGE_PASSWORD_POPUP_PASSWORD_STRENGTH'}}: <span id="strength-indicator" class="strong">{{t 'PAGE_CONFIG_RESTORE_MODAL_PASSWORD_STRONG'}}</span>
        </p>
      {{/if}}
    </div>

    <div class="password-requirements">
        <p class="message-info" tabindex="0" aria-label="{{t 'PAGE_PASSWORD_POPUP_SUBTITLE'}}">
          {{t 'PAGE_PASSWORD_POPUP_SUBTITLE'}}
        </p>
        {{#if this.ErrorMsg}}
          <p class="message-error" tabindex="0" aria-label="{{this.ErrorMsg}}">
            {{this.ErrorMsg}}
          </p>
        {{/if}}
    </div>
  </Modal.body>

  <Modal.footer>
    <BsButton 
      class="save-button" 
      @onClick={{this.savePassword}} 
      {{on "keyup" this.eaactrl.btnTrigger}}
      tabindex="0"
      aria-label="{{t 'PAGE_PASSWORD_POPUP_SAVE_BUTTON'}}"
      @type="Primary">
    {{t 'PAGE_PASSWORD_POPUP_SAVE_BUTTON'}}
    </BsButton>
    <BsButton 
      class="cancel-button" 
      @onClick={{this.closeModal}} 
      {{on "keyup" this.eaactrl.btnTrigger}}
      tabindex="0"
      aria-label="{{t 'PAGE_PASSWORD_POPUP_CANCEL_BUTTON'}}"
      @type="Light">
    {{t 'PAGE_PASSWORD_POPUP_CANCEL_BUTTON'}}
    </BsButton>
  </Modal.footer>
</BsModal>

